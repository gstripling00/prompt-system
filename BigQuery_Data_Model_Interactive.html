<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BigQuery Data Model - Agentic AI Prompt Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 40px;
            font-size: 1.1em;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: #f7fafc;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
        }
        
        .legend-icon {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        .pk { background: #4299e1; }
        .fk { background: #48bb78; }
        .timestamp { background: #ed8936; }
        .computed { background: #9f7aea; }
        
        .diagram {
            position: relative;
            margin: 40px 0;
        }
        
        .table-box {
            background: white;
            border: 3px solid #2d3748;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .table-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }
        
        .table-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            font-weight: bold;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .table-icon {
            font-size: 1.5em;
        }
        
        .table-description {
            background: #f7fafc;
            padding: 12px 20px;
            color: #4a5568;
            font-size: 0.9em;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .columns {
            padding: 20px;
        }
        
        .column {
            display: flex;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: #f7fafc;
            border-radius: 6px;
            border-left: 4px solid transparent;
            transition: background 0.2s;
        }
        
        .column:hover {
            background: #edf2f7;
        }
        
        .column.pk { border-left-color: #4299e1; }
        .column.fk { border-left-color: #48bb78; }
        .column.timestamp { border-left-color: #ed8936; }
        .column.computed { border-left-color: #9f7aea; }
        
        .column-name {
            font-weight: 600;
            color: #2d3748;
            min-width: 200px;
        }
        
        .column-type {
            background: #e2e8f0;
            color: #4a5568;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.85em;
            margin: 0 10px;
            font-family: 'Courier New', monospace;
        }
        
        .column-constraint {
            color: #e53e3e;
            font-weight: 600;
            font-size: 0.85em;
            margin-right: 10px;
        }
        
        .column-desc {
            color: #718096;
            font-size: 0.9em;
            flex: 1;
        }
        
        .relationships {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 30px;
            margin-top: 40px;
        }
        
        .relationships h2 {
            color: #2d3748;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .relationship {
            display: flex;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #48bb78;
        }
        
        .rel-from, .rel-to {
            font-weight: 600;
            color: #2d3748;
        }
        
        .rel-arrow {
            margin: 0 15px;
            color: #48bb78;
            font-size: 1.2em;
        }
        
        .rel-desc {
            color: #718096;
            font-size: 0.9em;
            margin-left: auto;
        }
        
        .tables-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä BigQuery Data Model</h1>
        <div class="subtitle">Agentic AI Prompt Management System - Database Schema</div>
        
        <!-- Statistics -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number">5</div>
                <div class="stat-label">Tables</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">71</div>
                <div class="stat-label">Total Columns</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">2</div>
                <div class="stat-label">Partitioned Tables</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">4</div>
                <div class="stat-label">Relationships</div>
            </div>
        </div>
        
        <!-- Legend -->
        <div class="legend">
            <div class="legend-item">
                <div class="legend-icon pk"></div>
                <span>Primary Key</span>
            </div>
            <div class="legend-item">
                <div class="legend-icon fk"></div>
                <span>Foreign Key</span>
            </div>
            <div class="legend-item">
                <div class="legend-icon timestamp"></div>
                <span>Timestamp</span>
            </div>
            <div class="legend-item">
                <div class="legend-icon computed"></div>
                <span>Computed/Denormalized</span>
            </div>
        </div>
        
        <!-- Tables Grid -->
        <div class="tables-grid">
            
            <!-- Table 1: prompts_master -->
            <div class="table-box">
                <div class="table-header">
                    <span class="table-icon">üìã</span>
                    <span>prompts_master</span>
                </div>
                <div class="table-description">
                    Master table of all active prompts (current versions only)
                </div>
                <div class="columns">
                    <div class="column pk">
                        <span class="column-name">prompt_id</span>
                        <span class="column-type">STRING</span>
                        <span class="column-constraint">REQUIRED</span>
                        <span class="column-desc">Unique identifier (e.g., ANLYS-LRN-001)</span>
                    </div>
                    <div class="column">
                        <span class="column-name">addie_phase</span>
                        <span class="column-type">STRING</span>
                        <span class="column-constraint">REQUIRED</span>
                        <span class="column-desc">Analysis, Design, Development, Implementation, Evaluation</span>
                    </div>
                    <div class="column">
                        <span class="column-name">sub_category</span>
                        <span class="column-type">STRING</span>
                        <span class="column-desc">Sub-category within ADDIE phase</span>
                    </div>
                    <div class="column">
                        <span class="column-name">prompt_name</span>
                        <span class="column-type">STRING</span>
                        <span class="column-constraint">REQUIRED</span>
                        <span class="column-desc">Human-readable name</span>
                    </div>
                    <div class="column">
                        <span class="column-name">prompt_text</span>
                        <span class="column-type">STRING</span>
                        <span class="column-constraint">REQUIRED</span>
                        <span class="column-desc">The actual prompt template</span>
                    </div>
                    <div class="column">
                        <span class="column-name">tags</span>
                        <span class="column-type">STRING</span>
                        <span class="column-desc">Comma-separated tags for search</span>
                    </div>
                    <div class="column">
                        <span class="column-name">prerequisites</span>
                        <span class="column-type">STRING</span>
                        <span class="column-desc">What's needed before using this prompt</span>
                    </div>
                    <div class="column">
                        <span class="column-name">expected_output</span>
                        <span class="column-type">STRING</span>
                        <span class="column-desc">What this prompt generates</span>
                    </div>
                    <div class="column">
                        <span class="column-name">version</span>
                        <span class="column-type">INTEGER</span>
                        <span class="column-constraint">REQUIRED</span>
                        <span class="column-desc">Version number (1, 2, 3...)</span>
                    </div>
                    <div class="column">
                        <span class="column-name">version_notes</span>
                        <span class="column-type">STRING</span>
                        <span class="column-desc">What changed in this version</span>
                    </div>
                    <div class="column">
                        <span class="column-name">author</span>
                        <span class="column-type">STRING</span>
                        <span class="column-desc">Who created/updated this prompt</span>
                    </div>
                    <div class="column timestamp">
                        <span class="column-name">created_date</span>
                        <span class="column-type">DATE</span>
                        <span class="column-constraint">REQUIRED</span>
                        <span class="column-desc">When first created</span>
                    </div>
                    <div class="column timestamp">
                        <span class="column-name">last_modified_date</span>
                        <span class="column-type">TIMESTAMP</span>
                        <span class="column-constraint">REQUIRED</span>
                        <span class="column-desc">When last updated</span>
                    </div>
                    <div class="column">
                        <span class="column-name">is_active</span>
                        <span class="column-type">BOOLEAN</span>
                        <span class="column-constraint">REQUIRED</span>
                        <span class="column-desc">Active (TRUE) or archived (FALSE)</span>
                    </div>
                    <div class="column computed">
                        <span class="column-name">usage_count</span>
                        <span class="column-type">INTEGER</span>
                        <span class="column-desc">Total times used (denormalized)</span>
                    </div>
                    <div class="column computed">
                        <span class="column-name">avg_rating</span>
                        <span class="column-type">FLOAT</span>
                        <span class="column-desc">Average user rating (denormalized)</span>
                    </div>
                    <div class="column">
                        <span class="column-name">embedding</span>
                        <span class="column-type">ARRAY&lt;FLOAT&gt;</span>
                        <span class="column-desc">768-dimension vector for semantic search</span>
                    </div>
                </div>
            </div>
            
            <!-- Table 2: prompts_history -->
            <div class="table-box">
                <div class="table-header">
                    <span class="table-icon">üìú</span>
                    <span>prompts_history</span>
                </div>
                <div class="table-description">
                    Complete version history and audit trail (all versions, never deleted)
                </div>
                <div class="columns">
                    <div class="column fk">
                        <span class="column-name">prompt_id</span>
                        <span class="column-type">STRING</span>
                        <span class="column-constraint">REQUIRED</span>
                        <span class="column-desc">Links to prompts_master</span>
                    </div>
                    <div class="column">
                        <span class="column-name">[All columns from prompts_master]</span>
                        <span class="column-desc">Complete snapshot of prompt at this version</span>
                    </div>
                    <div class="column timestamp">
                        <span class="column-name">changed_date</span>
                        <span class="column-type">TIMESTAMP</span>
                        <span class="column-constraint">REQUIRED</span>
                        <span class="column-desc">When this version was created</span>
                    </div>
                    <div class="column">
                        <span class="column-name">change_type</span>
                        <span class="column-type">STRING</span>
                        <span class="column-constraint">REQUIRED</span>
                        <span class="column-desc">INSERT, UPDATE, or ARCHIVE</span>
                    </div>
                </div>
            </div>
            
            <!-- Table 3: usage_analytics -->
            <div class="table-box">
                <div class="table-header">
                    <span class="table-icon">üìà</span>
                    <span>usage_analytics</span>
                </div>
                <div class="table-description">
                    Track every prompt usage event with ratings and feedback (partitioned by day)
                </div>
                <div class="columns">
                    <div class="column pk">
                        <span class="column-name">usage_id</span>
                        <span class="column-type">STRING</span>
                        <span class="column-constraint">REQUIRED</span>
                        <span class="column-desc">Unique event ID (UUID)</span>
                    </div>
                    <div class="column fk">
                        <span class="column-name">prompt_id</span>
                        <span class="column-type">STRING</span>
                        <span class="column-constraint">REQUIRED</span>
                        <span class="column-desc">Which prompt was used</span>
                    </div>
                    <div class="column">
                        <span class="column-name">user_email</span>
                        <span class="column-type">STRING</span>
                        <span class="column-desc">Who used it (nullable for privacy)</span>
                    </div>
                    <div class="column timestamp">
                        <span class="column-name">timestamp</span>
                        <span class="column-type">TIMESTAMP</span>
                        <span class="column-constraint">REQUIRED</span>
                        <span class="column-desc">When used (partition key)</span>
                    </div>
                    <div class="column">
                        <span class="column-name">addie_phase_context</span>
                        <span class="column-type">STRING</span>
                        <span class="column-desc">What phase user was working on</span>
                    </div>
                    <div class="column">
                        <span class="column-name">course_context</span>
                        <span class="column-type">STRING</span>
                        <span class="column-desc">What course/project</span>
                    </div>
                    <div class="column">
                        <span class="column-name">feedback_rating</span>
                        <span class="column-type">INTEGER</span>
                        <span class="column-desc">1-5 stars (nullable until rated)</span>
                    </div>
                    <div class="column">
                        <span class="column-name">feedback_text</span>
                        <span class="column-type">STRING</span>
                        <span class="column-desc">Optional written feedback</span>
                    </div>
                    <div class="column">
                        <span class="column-name">generation_successful</span>
                        <span class="column-type">BOOLEAN</span>
                        <span class="column-desc">Did execution work?</span>
                    </div>
                </div>
            </div>
            
            <!-- Table 4: prompt_executions -->
            <div class="table-box">
                <div class="table-header">
                    <span class="table-icon">‚öôÔ∏è</span>
                    <span>prompt_executions</span>
                </div>
                <div class="table-description">
                    Detailed logs of every Gemini API execution (partitioned by day)
                </div>
                <div class="columns">
                    <div class="column pk">
                        <span class="column-name">execution_id</span>
                        <span class="column-type">STRING</span>
                        <span class="column-constraint">REQUIRED</span>
                        <span class="column-desc">Unique execution ID (UUID)</span>
                    </div>
                    <div class="column fk">
                        <span class="column-name">prompt_id</span>
                        <span class="column-type">STRING</span>
                        <span class="column-constraint">REQUIRED</span>
                        <span class="column-desc">Which prompt was executed</span>
                    </div>
                    <div class="column">
                        <span class="column-name">user_email</span>
                        <span class="column-type">STRING</span>
                        <span class="column-desc">Who executed it</span>
                    </div>
                    <div class="column timestamp">
                        <span class="column-name">timestamp</span>
                        <span class="column-type">TIMESTAMP</span>
                        <span class="column-constraint">REQUIRED</span>
                        <span class="column-desc">When executed (partition key)</span>
                    </div>
                    <div class="column">
                        <span class="column-name">course_context</span>
                        <span class="column-type">STRING</span>
                        <span class="column-desc">Course being developed</span>
                    </div>
                    <div class="column">
                        <span class="column-name">addie_phase_context</span>
                        <span class="column-type">STRING</span>
                        <span class="column-desc">ADDIE phase context</span>
                    </div>
                    <div class="column">
                        <span class="column-name">model_used</span>
                        <span class="column-type">STRING</span>
                        <span class="column-desc">gemini-1.5-pro, gemini-1.5-flash, etc.</span>
                    </div>
                    <div class="column">
                        <span class="column-name">temperature</span>
                        <span class="column-type">FLOAT</span>
                        <span class="column-desc">Model temperature setting</span>
                    </div>
                    <div class="column">
                        <span class="column-name">max_tokens</span>
                        <span class="column-type">INTEGER</span>
                        <span class="column-desc">Token limit setting</span>
                    </div>
                    <div class="column">
                        <span class="column-name">inputs</span>
                        <span class="column-type">STRING</span>
                        <span class="column-desc">JSON string of placeholder values</span>
                    </div>
                    <div class="column">
                        <span class="column-name">filled_prompt</span>
                        <span class="column-type">STRING</span>
                        <span class="column-desc">Complete prompt sent to Gemini</span>
                    </div>
                    <div class="column">
                        <span class="column-name">generated_content_length</span>
                        <span class="column-type">INTEGER</span>
                        <span class="column-desc">Size of generated output</span>
                    </div>
                    <div class="column">
                        <span class="column-name">successful</span>
                        <span class="column-type">BOOLEAN</span>
                        <span class="column-constraint">REQUIRED</span>
                        <span class="column-desc">TRUE if execution succeeded</span>
                    </div>
                    <div class="column">
                        <span class="column-name">error_message</span>
                        <span class="column-type">STRING</span>
                        <span class="column-desc">Error details if failed</span>
                    </div>
                    <div class="column">
                        <span class="column-name">execution_time_ms</span>
                        <span class="column-type">INTEGER</span>
                        <span class="column-desc">How long execution took</span>
                    </div>
                    <div class="column">
                        <span class="column-name">content_rating</span>
                        <span class="column-type">INTEGER</span>
                        <span class="column-desc">1-5 star rating of output quality</span>
                    </div>
                    <div class="column">
                        <span class="column-name">content_feedback</span>
                        <span class="column-type">STRING</span>
                        <span class="column-desc">Feedback on generated content</span>
                    </div>
                </div>
            </div>
            
            <!-- Table 5: ingestion_log -->
            <div class="table-box">
                <div class="table-header">
                    <span class="table-icon">üì•</span>
                    <span>ingestion_log</span>
                </div>
                <div class="table-description">
                    CSV file processing logs for troubleshooting and monitoring
                </div>
                <div class="columns">
                    <div class="column pk">
                        <span class="column-name">log_id</span>
                        <span class="column-type">STRING</span>
                        <span class="column-constraint">REQUIRED</span>
                        <span class="column-desc">Unique log entry ID</span>
                    </div>
                    <div class="column timestamp">
                        <span class="column-name">timestamp</span>
                        <span class="column-type">TIMESTAMP</span>
                        <span class="column-constraint">REQUIRED</span>
                        <span class="column-desc">When processing occurred</span>
                    </div>
                    <div class="column">
                        <span class="column-name">file_name</span>
                        <span class="column-type">STRING</span>
                        <span class="column-constraint">REQUIRED</span>
                        <span class="column-desc">CSV file name processed</span>
                    </div>
                    <div class="column">
                        <span class="column-name">records_processed</span>
                        <span class="column-type">INTEGER</span>
                        <span class="column-constraint">REQUIRED</span>
                        <span class="column-desc">Total rows in CSV</span>
                    </div>
                    <div class="column">
                        <span class="column-name">records_inserted</span>
                        <span class="column-type">INTEGER</span>
                        <span class="column-constraint">REQUIRED</span>
                        <span class="column-desc">New prompts added</span>
                    </div>
                    <div class="column">
                        <span class="column-name">records_updated</span>
                        <span class="column-type">INTEGER</span>
                        <span class="column-constraint">REQUIRED</span>
                        <span class="column-desc">Existing prompts updated</span>
                    </div>
                    <div class="column">
                        <span class="column-name">records_failed</span>
                        <span class="column-type">INTEGER</span>
                        <span class="column-constraint">REQUIRED</span>
                        <span class="column-desc">Rows that failed validation</span>
                    </div>
                    <div class="column">
                        <span class="column-name">status</span>
                        <span class="column-type">STRING</span>
                        <span class="column-constraint">REQUIRED</span>
                        <span class="column-desc">SUCCESS, PARTIAL_SUCCESS, or FAILED</span>
                    </div>
                    <div class="column">
                        <span class="column-name">error_message</span>
                        <span class="column-type">STRING</span>
                        <span class="column-desc">Error details if failed</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Relationships -->
        <div class="relationships">
            <h2>üîó Table Relationships</h2>
            
            <div class="relationship">
                <span class="rel-from">prompts_master.prompt_id</span>
                <span class="rel-arrow">‚Üí</span>
                <span class="rel-to">prompts_history.prompt_id</span>
                <span class="rel-desc">One-to-many: Each prompt has multiple versions in history</span>
            </div>
            
            <div class="relationship">
                <span class="rel-from">prompts_master.prompt_id</span>
                <span class="rel-arrow">‚Üí</span>
                <span class="rel-to">usage_analytics.prompt_id</span>
                <span class="rel-desc">One-to-many: Each prompt can have many usage events</span>
            </div>
            
            <div class="relationship">
                <span class="rel-from">prompts_master.prompt_id</span>
                <span class="rel-arrow">‚Üí</span>
                <span class="rel-to">prompt_executions.prompt_id</span>
                <span class="rel-desc">One-to-many: Each prompt can be executed multiple times</span>
            </div>
            
            <div class="relationship">
                <span class="rel-from">usage_analytics</span>
                <span class="rel-arrow">‚Üî</span>
                <span class="rel-to">prompts_master.usage_count, avg_rating</span>
                <span class="rel-desc">Denormalized: Aggregated stats cached in prompts_master for performance</span>
            </div>
        </div>
        
    </div>
</body>
</html>
